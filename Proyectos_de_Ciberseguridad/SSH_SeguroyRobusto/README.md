# SSH Seguro y Robusto: Autenticaci√≥n por Clave P√∫blica, Banner Legal, UFW, Fail2ban y Port Knocking

## üìù Resumen del Proyecto

Este proyecto detalla la implementaci√≥n de un entorno SSH (Secure Shell) avanzado y altamente seguro en una m√°quina Kali Linux. El objetivo principal es fortalecer el acceso remoto al servidor, protegerlo contra ataques comunes y mantener una postura de seguridad proactiva.

**Objetivos clave:**
* Configurar SSH con autenticaci√≥n robusta mediante clave p√∫blica.
* Personalizar el puerto de escucha de SSH para mayor discreci√≥n.
* Implementar un banner legal para advertencia y disuasi√≥n.
* Configurar `ufw` como cortafuegos para controlar el tr√°fico.
* Integrar `fail2ban` para mitigar ataques de fuerza bruta.
* Implementar `port knocking` con `knockd` para ocultar el servicio SSH hasta una secuencia espec√≠fica.

## üõ†Ô∏è Tecnolog√≠as y Herramientas Utilizadas

* **Sistema Operativo:** Kali Linux
* **Servicio de Acceso Remoto:** OpenSSH Server
* **Cortafuegos:** UFW (Uncomplicated Firewall)
* **Detecci√≥n y Bloqueo de Intrusiones:** Fail2ban
* **Ocultamiento de Puertos:** Knockd (Port Knocking)
* **Generaci√≥n de Claves:** SSH-keygen
* **Cliente SSH (Windows):** PuTTY

## üöÄ Paso a Paso de la Implementaci√≥n

### FASE 1: Preparaci√≥n e Instalaci√≥n de Software Base

Se actualiz√≥ el sistema y se instalaron los paquetes esenciales para el proyecto: `openssh-server`, `ufw`, `fail2ban` y `knockd`.

* **Captura:** Instalaci√≥n de Software Base.
    ![Instalaci√≥n de Software Base](Captura_Software_base.png)

* **Captura:** Direcci√≥n IP del servidor Kali (fundamental para la conexi√≥n remota).
    ![Direcci√≥n IP](IPADDR.png)

* **Captura:** Creaci√≥n del usuario dedicado para SSH (`sshuser`).
    ![Creaci√≥n de sshuser](Captura_Creacion_sshuser.PNG)

### FASE 2: Hardening del Servicio SSH

Se realizaron configuraciones clave en el archivo `/etc/ssh/sshd_config` para fortalecer el servicio SSH:

* **Paso 1: Configuraci√≥n b√°sica del servicio SSH**
    Se ha editado `/etc/ssh/sshd_config` para:
    * Desactivar el login con contrase√±a (`PasswordAuthentication no`).
    * Cambiar el puerto por defecto a `2222`.
    * Deshabilitar `ChallengeResponseAuthentication`.
    * Incluir el archivo del banner legal (`Banner /etc/issue.net`).

    > ‚ö†Ô∏è **Nota sobre el puerto:** Aunque lo ideal ser√≠a usar un puerto superior al 10000 para dificultar su detecci√≥n mediante escaneos simples (como indic√≥ el profesor), este ejercicio se centra en cambiar el puerto para demostrar la funcionalidad.

    **Captura:** Configuraci√≥n Inicial de `sshd_config` (Puerto 2222, `PasswordAuthentication no`).
    ![Configuraci√≥n SSH B√°sica](Captura_ConfiguracionSSH_Basica.png)

* **Paso 2: Configuraci√≥n avanzada de `/etc/ssh/sshd_config`**
    Se aplicaron ajustes adicionales para mejorar la seguridad y la gesti√≥n de sesiones:
    * Configuraci√≥n de tiempos de actividad para desconectar sesiones inactivas (`ClientAliveInterval`, `ClientAliveCountMax`).
    * Otras optimizaciones de seguridad (como `UsePAM no`, `X11Forwarding no`, etc., si se aplicaron).

    **Captura:** Configuraci√≥n SSH Avanzada (par√°metros adicionales de seguridad y sesi√≥n).
    ![Configuraci√≥n SSH Avanzada](Captura_ConfiguracionSSH_Avanzada.png)

* **Paso 3: Creaci√≥n del banner legal**
    Se cre√≥ el archivo `/etc/issue.net` con un mensaje de advertencia legal que se mostrar√° a los usuarios al intentar conectarse.

    **Captura:** Contenido del Banner Legal.
    ![Creaci√≥n de Banner](Captura_banner.png)

* **Paso 4: Generaci√≥n de claves SSH y permisos**
    Se generaron pares de claves SSH (p√∫blica y privada) para el `sshuser`, asegurando que la autenticaci√≥n se realice por clave y no por contrase√±a.

    **Captura:** Proceso de Generaci√≥n de Claves SSH (`ssh-keygen`).
    ![Generaci√≥n de Claves](Captura_GeneracionClave.png)

* **Paso 5: Verificaci√≥n del estado del servicio SSH**
    Se confirm√≥ que el servicio SSH (`sshd`) se est√° ejecutando correctamente despu√©s de las modificaciones y reinicios.

    **Captura:** Estado del Servicio SSH.
    ![Estado del Servicio SSH](Captura_StatusSSHD.PNG)

### FASE 3: Configuraci√≥n del Cortafuegos UFW

Se configuraron las reglas de UFW para permitir la conexi√≥n SSH solo de forma din√°mica a trav√©s de Port Knocking.

* **Paso 1: Configuraci√≥n inicial de UFW**
    Se establecieron las pol√≠ticas por defecto y se aseguraron los permisos. **Importante:** el puerto `2222` no debe estar expl√≠citamente abierto de forma permanente en UFW para que el Port Knocking funcione correctamente.

    **Captura:** Reglas de UFW (mostrando el puerto SSH no abierto permanentemente).
    ![Reglas UFW](Captura_reglasUFW.png)

* **Paso 2: Verificaci√≥n de correcciones**
    Se realiz√≥ una verificaci√≥n de las reglas aplicadas en UFW.

    **Captura:** Correcciones y Reglas de UFW.
    ![Correcciones UFW](Captura_Correciones.png)

### FASE 4: Configuraci√≥n de Fail2ban

Se configur√≥ Fail2ban para proteger el servicio SSH contra ataques de fuerza bruta, bloqueando las IPs que intenten repetidamente iniciar sesi√≥n sin √©xito.

* **Paso 1: Configuraci√≥n de `jail.local`**
    Se personaliz√≥ `/etc/fail2ban/jail.local` para configurar el jail `sshd`, especificando el puerto `2222`, el tiempo de baneo (`bantime`) y el n√∫mero de reintentos (`maxretry`).

    **Captura:** Archivo de Configuraci√≥n de Fail2ban (`jail.local`).
    ![Configuraci√≥n Fail2ban](Captura_Archivo_Fail2ban.png)

* **Paso 2: Verificaci√≥n del estado de Fail2ban**
    Se confirm√≥ que el jail `sshd` de Fail2ban est√° activo y monitoreando el servicio SSH.

    **Captura:** Estado del Servicio Fail2ban.
    ![Estado Fail2ban](Captura_Statusfail2ban.PNG)

### FASE 5: Configuraci√≥n de Port Knocking con `knockd`

Se implement√≥ `knockd` para que el puerto SSH (`2222`) permanezca oculto y solo se abra tras recibir una secuencia espec√≠fica de "golpes" a puertos predefinidos.

* **Paso 1: Configuraci√≥n de `knockd` en `/etc/default/knockd`**
    Se habilit√≥ el inicio de `knockd` con el sistema.

    **Captura:** Configuraci√≥n de Inicio de Knockd.
    ![Configuraci√≥n Knockd](Captura_configuracionKonckd.png)

* **Paso 2: Configuraci√≥n de secuencias en `/etc/knockd.conf`**
    Se definieron las secuencias de puertos para "abrir" y "cerrar" el puerto SSH, junto con las acciones de UFW asociadas a cada secuencia.

    **Captura:** Configuraci√≥n de `knockd.conf` (Secuencias de Puertos y Acciones UFW).
    ![Configuraci√≥n knockd.conf](Captura_knockdconfig.png)

### FASE 6: Verificaci√≥n y Pruebas del Entorno Seguro

Se realizaron pruebas exhaustivas para confirmar que todas las medidas de seguridad funcionan como se espera.

* **Paso 1: Verificaci√≥n de estados generales**
    Se realizaron comprobaciones adicionales del estado de los servicios.

    **Captura:** Verificaci√≥n de Estados de Servicios.
    ![Verificaci√≥n de Estados](Captura_Verificacion de estados.png)

* **Paso 2: Conexi√≥n desde cliente SSH local tras port knocking**
    Se demostr√≥ el funcionamiento del Port Knocking:
    1.  `nmap` inicial mostrando el puerto `2222` como **filtrado/cerrado**.
    2.  Ejecuci√≥n de la secuencia de `knock` para abrir el puerto.
    3.  `nmap` posterior mostrando el puerto `2222` como **abierto**.
    4.  Conexi√≥n SSH exitosa al puerto `2222`.
    5.  (Idealmente) Ejecuci√≥n de la secuencia de `knock` para cerrar el puerto.
    6.  (Idealmente) `nmap` final mostrando el puerto `2222` como **filtrado/cerrado** de nuevo.

    **Captura:** Demostraci√≥n del Port Knocking y Conexi√≥n SSH Local Exitosa.
    ![Conexiones Locales](Captura_conexiones.png)

* **Paso 3: Conexi√≥n desde cliente externo (Windows + PuTTY)**
    Se valid√≥ la conexi√≥n SSH desde un sistema operativo diferente (Windows) utilizando PuTTY, confirmando que el banner legal se muestra y que la autenticaci√≥n por clave funciona.

    **Captura:** Conexi√≥n Exitosa desde Windows con PuTTY (mostrando el banner).
    ![Conexi√≥n desde Windows](Captura_Windows.png)

## üí° Conclusi√≥n y Aprendizajes Clave

Este proyecto ha permitido implementar y comprender un conjunto robusto de t√©cnicas de seguridad para el acceso SSH, cruciales en cualquier entorno de red.

**Aprendizajes clave:**
* **Hardening SSH:** La importancia de ir m√°s all√° del puerto por defecto, deshabilitar m√©todos de autenticaci√≥n d√©biles (contrase√±a, root directo) y usar claves p√∫blicas.
* **Cortafuegos (`ufw`):** La base para controlar el tr√°fico de red, permitiendo solo lo estrictamente necesario y trabajando en conjunto con otras herramientas.
* **Fail2ban:** Un sistema eficaz para automatizar la defensa contra ataques de fuerza bruta, analizando logs y bloqueando autom√°ticamente IPs maliciosas.
* **Port Knocking (`knockd`):** Una capa de seguridad adicional que oculta un servicio, haci√©ndolo invisible hasta una secuencia de "golpes" correcta. Permite un acceso din√°mico y sigiloso.
* **Integraci√≥n de Seguridad:** La eficacia de combinar m√∫ltiples herramientas (SSH, UFW, Fail2ban, Knockd) para crear una defensa en profundidad, donde cada capa complementa a las dem√°s.
* **Resoluci√≥n de Problemas:** La experiencia de depurar y superar desaf√≠os de configuraci√≥n (como el problema anterior con el puerto de `nmap`) ha sido fundamental para consolidar el conocimiento y demostrar la capacidad de an√°lisis.

Este proyecto refuerza la importancia de la seguridad por capas y la implementaci√≥n de principios de "m√≠nimo privilegio" y "defensa en profundidad" en la administraci√≥n de sistemas.

---

**Consideraciones para tu portfolio:**

* **Actualiza los nombres de archivo de las capturas:** Recuerda asegurarte de que todas tus capturas f√≠sicas en tu repositorio (GitHub, etc.) tengan la extensi√≥n `.png` (ej., `Captura_Archivo_Fail2ban.png` en lugar de `.jpg`).
* **Revisa tus capturas de prueba:** Para los pasos 6 (Reglas UFW), 11 (Conexi√≥n local) y 12 (Conexi√≥n Windows), aseg√∫rate de que las capturas muestren el comportamiento esperado del Port Knocking (puerto cerrado -> knocks -> puerto abierto -> conexi√≥n). Si es necesario, divide el Paso 11 en 2 o 3 capturas para mostrar todo el flujo de `nmap`/`knock`/`nmap`.
* **Considera un GIF:** Para el Port Knocking, un GIF animado mostrando la secuencia `nmap -> knock -> nmap` ser√≠a incre√≠blemente visual y demostrativo.

Este `README.md` es mucho m√°s completo y profesional. ¬°Espero que te sea de gran utilidad para tu portfolio!